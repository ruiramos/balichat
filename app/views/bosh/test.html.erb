<div class="span2">
  <div class="left-column hidden-phone">
    <div class="filters box" id="filters-amizade">
      <h3>Content</h3>
      <ul id="filters" class="box-content nav nav-pills nav-stacked">
        <li class="active"><a href="#">All</a></li>
        <li><a href="#">Links</a></li>
        <li><a href="#">Images</a></li>
        <li><a href="#">Files</a></li>
        <li><a href="#" id="mentions-tooltip" rel="tooltip" data-placement="right" data-original-title="Coming soon!"  class="coming-soon">Mentions</a></li>
        <li><a href="#" id="alerts-tooltip" rel="tooltip" data-placement="right" data-original-title="Coming soon!" class="coming-soon">Alerts</a></li>
      </ul>
    </div>
    <div class="files box" id="files-amizade">
      <h3>Latest files 
          <a href="#" id="files-info-tooltip" rel="tooltip" data-placement="top" data-original-title="You can easily upload files by drag-and-dropping them to the chat window!" class="pull-right"><img src="/assets/info.png" class="files-info" /></a>
      </h3>
      <ul id="files" class="box-content files">
        <% for document in Document.where(chatroom: "amizade@conference.#{JABBER[:host]}") %>
        <li>
          <i class="icon-file"></i> 
          <%= link_to document.filename, "http://balichat_dev.s3.amazonaws.com/#{document.remote_url}" %>
        </li>
        <% end %>
      </ul>
      
      <form action="https://<%=UPLOADS[:bucket]%>.s3.amazonaws.com" method="post" enctype="multipart/form-data" class="direct-upload">
        <input type="hidden" name="AWSAccessKeyId" value="<%=UPLOADS[:aws_access_key]%>">
        <input type="hidden" name="key">
        <input type="hidden" name="acl" value="public-read">
        <input type="hidden" name="policy">
        <input type="hidden" name="signature">
        <input type="hidden" name="success_action_status" value="201">

        <input type="file" name="file">

        <div class="progress progress-striped active"><div class="bar"></div></div>
      </form>
    </div>
   </div>
  </div>

  <div class="span8 chat-column">
    <h3 id="topic-amizade" class="topic editable">No topic</h3>
    <h3 class="topic edit hide"><%= text_field_tag :topic, '', class: 'span11 topic' %> <%= link_to_function 'Save', 'gui.submitTopic("_button")', class: 'btn btn-small' %></h3>

    <div class="chat-window scroll-pane" id="muc-amizade">
      <div class="chat-muc-messages">
        <div class="row-fluid hide message-container" id="empty-message">
          <div class="message">
            <div class="span1">
              <div class="message-avatar hidden-phone">
                <div class="avatar-placeholder">&nbsp;</div>
              </div>            
            </div>
            <div class="span11">
              <div class="message-content">
                <p class="nick">Nick</p>
                <p class="timestamp">Time</p>
                <p class="text">Message</p>
              </div>
            </div>
          </div>
        </div>

        <div class="row-fluid message-container" id="welcome-message">
          <div class="message system">
            <div class="span1">&nbsp;</div>
            <div class="span11">
              <div class="message-content">
                <p class="nick">Welcome message</p>
                <p class="timestamp">Time</p>
                <p class="text">Message</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="chat-input form-inline">
      <table width="100%" cellspacing="0">
        <tbody>
          <tr>
            <td><%= text_area :input, '', class: 'chat-input-field', rows: 2 %></td>
            <td class="btn-send-td"><%= link_to_function 'Send', 'return false', class: 'btn btn-info btn-send' %></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="span2">
    <div class="right-column">
    <div class="user-list box" id="user-list-amizade">
      <h3>Users</h3>
      <ul class="users box-content unstyled">
        <li class="concierge">
          <div class="online-placeholder img-rounded img-polaroid">
            <div class="userimg" style="background:url('/assets/concierge32.png')"></div>
          </div>
          <div class="user-name-container"><span class="concierge">Concierge</span>
        </li>

        <li id="empty-user" class="hide">
          <div class="online-placeholder img-rounded img-polaroid">
            <div class="userimg" style="background:url('/assets/default-avatar.png')"></div>
          </div>
          <div class="user-name-container"><span class="user-name">&nbsp;</span></div>
        </li>
      </ul>
    </div>

    <div class="search box" id="search-amizade">
      <h3>Search</h3>
      <div class="input-append box-content">
        <input class="" id="appendedInputButtons" type="text">
        <button class="btn" type="button"><i class="icon-search"></i></button>
      </div>
    </div>

    <div class="timeline box" id="timeline-amizade">
      <h3>Timeline</h3>
    </div>

    <div class="options box" id="options-amizade">
      <h3>Options</h3>
      <div class="box-content">
        <label class="checkbox"><input id="expand-embeds" type="checkbox" checked="checked">Expand embeds</label>
      </div>
    </div>


  </div>
</div>

<script type="text/javascript">
  var jabber = null;
  var gui = null;

  $(document).ready(function () {
    $('.scroll-pane').jScrollPane();
    gui = new Ui();

    jabber = new Jabber();
    jabber.connect('<%= @jid %>', '<%= @sid %>', '<%= @rid %>', '<%= JABBER[:host] %>');

    // update chat-window size
    $(window).resize(function(){
      h = $(window).height()-170;
      $(".chat-window").css("height", h);
      $(".chat-window").css("width", $(".chat-column").css("width"));
      window.muc.ui.api.reinitialise();
    });
    $(window).resize();

    // Welcome message
    var mucName = Strophe.getNodeFromJid(window.muc.jid);
    $('#welcome-message').find('.nick').text('Welcome to '+mucName);
    $('#welcome-message').find('.timestamp').text(moment().format(window.muc.ui.timeFormat));
  });
</script>